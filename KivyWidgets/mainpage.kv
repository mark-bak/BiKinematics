#:kivy 1.11.1 
#:import rgba kivy.utils.get_color_from_hex

#general layout properties
#: set sidebar_width 420
#: set sidebar_coords_height 30
#: set topbar_height 50
#: set topbar_btn_width 150

#: set Colour_1 rgba("#f7f2f5")
#: set Colour_2 rgba("#6e8e9e")
#: set Colour_3 rgba("#3c7a89")
#: set Colour_4 rgba("#2e4756")
#: set Colour_5 rgba("#1b2f37")

<MainPage>:
    canvas.before:
        Color:
            rgba: Colour_5
        Rectangle:
            pos: self.pos
            size:self.size
        Color:
            rgba: Colour_3
        Rectangle:
            pos: (self.x,self.height-topbar_height)
            size: (self.width,topbar_height)
        Color:
            rgba: Colour_4
        Rectangle:
            pos: (self.width-sidebar_width,0)
            size: (sidebar_width,self.height-topbar_height)
    canvas.after:
        Color:
            rgba: Colour_1
        Line:
            points: [(self.width-sidebar_width,0),(self.width-sidebar_width,self.height-topbar_height)]
    AnchorLayout:
        id: current_mode
        anchor_x: "left"
        anchor_y: "bottom"
        size_hint: None,None
        size: lbl.size 
        Label:
            id: lbl
            text: root.mode + root.info
            color: Colour_1
            size: self.texture_size  
            
    AnchorLayout:     
        anchor_x: "right"
        anchor_y: "bottom"
        BoxLayout:
            orientation: "vertical"
            size_hint_x: None
            width: sidebar_width
            size_hint_y: None
            height: root.height - topbar_height

            BoxLayout: #Sidebar button layout
                id: points_list
                orientation: "vertical"
                size_hint: (None,None)
                width: sidebar_width
                height: self.minimum_height
                canvas.before:
                    Color:
                        rgba: Colour_4
                    Rectangle:
                        size: self.size
                        pos: self.pos  
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y:None
                    height: sidebar_coords_height
                    SidebarLabel:
                        text: "Point"
                    SidebarLabel:
                        text: "Type"
                    SidebarLabel:
                        text: "x_pos"
                    SidebarLabel:
                        text: "y_pos" 

            BoxLayout:
                id: links_list
                orientation: "vertical"
                size_hint: (None,None)
                height: self.minimum_height
                width: sidebar_width
                canvas.before:
                    Color:
                        rgba: Colour_4
                    Rectangle:
                        size: self.size
                        pos: self.pos  
                BoxLayout:
                    orientation: 'horizontal'
                    size_hint_y:None
                    height: sidebar_coords_height
                    SidebarLabel:
                        text: "Link"
                    SidebarLabel:
                        text: "Length"

    AnchorLayout: #Top button anchor      
        anchor_y: "top"
        anchor_x: "left"
        BoxLayout: #Topbar button layout
            size_hint_y: None
            height: topbar_height
            id: topbar
            orientation: "horizontal"
            # canvas.after:
            #     Color:
            #         rgba: 0,0,1,0.5
            #     Rectangle:
            #         size: self.size
            #         pos: self.pos
            TopbarButton:
                text: 'Load...'
                on_release: root.show_load_dropdown(self)
            TopbarButton:
                text: 'Add Geo...'
                on_release: root.show_add_geo_dropdown(self)

            TopbarButton:
                text: 'Delete Point'
                on_release: root.delete_point_mode()
            TopbarButton:
                text: 'Delete Link'
                on_release: root.delete_link_mode()
            TopbarButton:
                text: 'Clear All'
                on_release: root.clear_all()
            TopbarButton:
                text: 'Plot'
                on_release: root.goto_plot()
            Label:

<TopbarButton@Button>:
    color: Colour_1
    background_normal: ''
    background_color: Colour_3
    size_hint_x: None
    width: topbar_btn_width
    canvas.after:
        Color:
            rgba: Colour_1
        Line:
            points: [(self.pos),(self.x,self.y+self.height)]
        Line:
            points: [(self.x+self.width,self.y),(self.x+self.width,self.y+self.height)]

<SidebarLabel@Label>:
    color: Colour_1
    canvas.after:
        Color:
            rgba: Colour_1
        Line:
            points: [(self.pos),(self.x+self.width,self.y)]

<LoadDropDown>:
    TopbarButton:
        text: 'Load Geo Data'
        size_hint_y: None
        height: topbar_height
        on_release:root.dismiss()
        on_release: root.mp.open_load_dialog()
    TopbarButton:
        text: 'Save Geo Data'
        size_hint_y: None
        height: topbar_height
        on_release:root.dismiss()
        on_release: root.mp.open_save_dialog()
    TopbarButton:
        text: 'Load Image (wip)'
        size_hint_y: None
        height: topbar_height
        on_release:root.dismiss()

<AddGeoDropDown>:
    TopbarButton:
        text: 'Add Point'
        size_hint_y: None
        height: topbar_height
        on_release:root.dismiss()
        on_release: root.mp.point_mode()
    TopbarButton:
        text: 'Add Link'
        size_hint_y: None
        height: topbar_height
        on_release:root.dismiss()
        on_release: root.mp.link_mode()

<-ThemePopup>:
    title_color: Colour_1
    bg_color: Colour_2
    
    #Mega hack I got from stackoverflow so that you cna change the bg colour....
    _container: container
    GridLayout:
        padding: '12dp'
        cols: 1
        size_hint: None, None
        pos: root.pos
        size: root.size
        Label:
            canvas.before:
                Color:
                    rgba: root.bg_color
                Rectangle:
                    pos: self.pos
                    size: self.size
            text: root.title
            color: root.title_color
            size_hint_y: None
            height: self.texture_size[1] + dp(16)
            text_size: self.width - dp(16), None
            font_size: root.title_size
            font_name: root.title_font
            halign: root.title_align

        Widget:
            size_hint_y: None
            height: dp(4)
            canvas.before:
                Color:
                    rgba: root.bg_color
                Rectangle:
                    pos: self.pos
                    size: self.size
        BoxLayout:
            canvas.before:
                Color:
                    rgba: root.bg_color
                Rectangle:
                    pos: self.pos
                    size: self.size 
            id: container